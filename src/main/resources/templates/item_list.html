<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>持ち物一覧</title>

	<link rel="stylesheet" th:href="@{/css/item_list.css}">
	<script th:src="@{/js/item_list.js}" defer></script>

</head>

<body>
	<div class="logo-container">
		<img src="/images/logo.png" alt="ロゴ" class="logo-image">
	</div>


	<div class="content-wrapper">
		<h2>FES もちものリスト</h2>
		<p class="hello-message" th:text="${'こんにちは！'+session.loginUser.name + 'さん！'}"></p>

		<p th:if="${message}" th:text="${message}" class="success-message"></p>
		
		<form th:action="@{/item/list}" method="get" class="filter-form" id="searchForm">
  <!-- 検索したら必ず1ページ目に戻す -->
  <input type="hidden" name="page" value="1"/>

  <label>フェス名：</label>
  <select name="festivalId" id="festivalId" class="select">
    <option value="">----------選択----------</option>
    <option th:each="festival : ${festivalList}"
            th:value="${festival.id}"
            th:text="${festival.fesName}"
            th:selected="${festivalId} != null and festival.id == festivalId">
    </option>
  </select>

  <label>カテゴリ：</label>
  <select name="category" id="category" class="select">
    <option value="">-----選択-----</option>
    <option value="必須"   th:selected="${category} == '必須'">必須</option>
    <option value="貴重品" th:selected="${category} == '貴重品'">貴重品</option>
    <option value="化粧品" th:selected="${category} == '化粧品'">化粧品</option>
    <option value="日用品" th:selected="${category} == '日用品'">日用品</option>
    <option value="食品"   th:selected="${category} == '食品'">食品</option>
    <option value="衣類"   th:selected="${category} == '衣類'">衣類</option>
  </select>

  <button type="submit" class="search-btn">検索</button>
  <a th:href="@{/item/list}" class="reset-btn">リセット</a>
</form>

        
     


		<!-- 天気カード -->
		<p th:if="${weatherError}" th:text="${weatherError}" class="error-message"></p>

		<div class="weather-card" th:if="${weather}">
		  <div class="weather-card__header">
		    <img th:src="@{|https://openweathermap.org/img/wn/${weather.icon}@2x.png|}"
		         alt="天気アイコン" class="weather-card__icon"/>
		    <div>
		      <strong th:text="${weatherPlace}">開催地</strong>
		      <div th:text="${weather.description}">くもり</div>
		    </div>
		  </div>
		  <div class="weather-card__grid">
		    <div><span>気温</span><strong th:text="${#numbers.formatDecimal(weather.temp, 1, 1)}">22.5</strong>℃</div>
		    <div><span>体感</span><strong th:text="${#numbers.formatDecimal(weather.feelsLike, 1, 1)}">21.8</strong>℃</div>
		    <div><span>湿度</span><strong th:text="${weather.humidity}">65</strong>%</div>
		    <div><span>風速</span><strong th:text="${#numbers.formatDecimal(weather.windSpeed, 1, 1)}">3.2</strong>m/s</div>
		  </div>
		</div>
		

		<div class="item-list">
			<div th:each="item,iterStat : ${itemList}" class="item-card">

				<p><strong>NO : </strong><span th:text="${iterStat.index+1}"></span></p>
				<p><strong>フェス名 : </strong><span th:text="${item.festivalName}"></span></p>
				<p><strong>持ち物 : </strong><span th:text="${item.itemName}"></span></p>
				<p><strong>カテゴリ : </strong><span th:text="${item.category}"></span>
				<p><strong>数量 : </strong><span th:text="${item.quantity}"></span>

				<p class="action-buttons">
					<strong>操作 :</strong>
					<a th:href="@{/item/edit/{id}(id=${item.id})}">編集</a>
					<a th:href="@{'/item/delete/' +${item.id}}" onclick="return confirm('削除しますか？')">削除</a>
				</p>

			</div>
		</div>

		<!-- ページネーションリンク -->
		<div class="pagination-area">
		  <div class="pagination">
		    <span th:each="pageNum : ${#numbers.sequence(1, totalPages)}">
		      <a th:href="@{/item/list(page=${pageNum},
		                               festivalId=${festivalId},
		                               category=${category})}"
		         th:text="${pageNum}"
		         th:classappend="${pageNum == currentPage} ? 'active' : ''">
		      </a>
		    </span>
		  </div>
		  <a th:href="@{/item/new}" class="add-item-btn">新規持ち物登録</a>
		</div>
	</div>

	<a th:href="@{/memo/list}" class="fes-memo-btn">FES MEMO</a>
	<a th:href="@{/logout}" class="logout-btn">ログアウト</a>
</body>

</html>